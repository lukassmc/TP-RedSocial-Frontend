
<div class="create-post-container">
 
  <button 
    *ngIf="!showForm"
    (click)="toggleForm()" 
    class="create-post-toggle"
  >
    <i class="bi bi-plus-lg"></i>
    Crear PublicaciÃ³n
  </button>


  <div *ngIf="showForm" class="create-post-form">
   
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

  
    <div class="form-group">
      <label class="form-label">TÃ­tulo *</label>
      <input
        type="text"
        [(ngModel)]="postData.title"
        class="form-input"
        placeholder="Escribe un tÃ­tulo llamativo..."
        maxlength="100"
      />
      <div class="char-count" [class.warning]="postData.title.length > 80">
        {{ postData.title.length }}/100
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Contenido *</label>
      <textarea
        [(ngModel)]="postData.content"
        class="form-textarea"
        placeholder="Comparte lo que tienes en mente..."
        maxlength="1000"
      ></textarea>
      <div class="char-count" [class.warning]="postData.content.length > 800" [class.error]="postData.content.length > 950">
        {{ postData.content.length }}/1000
      </div>
    </div>

  
    <div class="form-group">
      <label class="form-label">Imagen (opcional)</label>
      <div class="image-upload-container" *ngIf="!imagePreview">
        <label class="image-upload-label">
          <input
            type="file"
            (change)="onFileSelected($event)"
            accept="image/*"
            class="file-input"
          />
          <div class="upload-icon">ðŸ“·</div>
          <div class="upload-text">Subir imagen</div>
          <div class="upload-subtext">PNG, JPG, WEBP hasta 5MB</div>
        </label>
      </div>
      <div *ngIf="imagePreview" class="image-preview">
        <img [src]="imagePreview" alt="Preview" class="preview-image" />
        <button (click)="removeImage()" class="remove-image" title="Quitar imagen">
          Ã—
        </button>
      </div>
    </div>

    <button type="button" class="music-btn" (click)="toggleMusicSelector()">
  ðŸŽµ Agregar mÃºsica
</button>

<div *ngIf="showMusicSelector" class="music-selector-box">
  
  <!-- Buscador -->
  <app-music-search 
      (songSelected)="onSongSelected($event)"
      class="music-scroll-panel">
  </app-music-search>

  <img [src]="selectedSong.artwork" alt="">

</div>
   
    <div class="form-actions">
      <button 
        (click)="toggleForm()" 
        class="cancel-btn"
        [disabled]="loading"
      >
        Cancelar
      </button>
      <button 
        (click)="onSubmit()" 
        class="submit-btn"
        [disabled]="loading"
      >
        <div *ngIf="loading" class="loading-spinner"></div>
        {{ loading ? 'Publicando...' : 'Publicar' }}
      </button>
    </div>
  </div>
</div>